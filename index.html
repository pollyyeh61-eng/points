<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>美業庫存管理 | HOLY HAIR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold-base: #BF953F;
            --gold-bright: #FCF6BA;
            --gold-dark: #8A6E2F;
            --bg-deep: #050505;
        }

        body {
            background-color: var(--bg-deep);
            color: #D4D4D4;
            font-family: 'Noto Serif TC', serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* 流金系列字體 */
        .gold-text {
            background: linear-gradient(135deg, var(--gold-base), var(--gold-bright), var(--gold-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Cinzel', serif;
            letter-spacing: 0.1em;
        }

        /* 呼吸感卡片框架 */
        .luxury-card {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(191, 149, 63, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            animation: border-breathe 5s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        @keyframes border-breathe {
            0%, 100% { border-color: rgba(191, 149, 63, 0.2); box-shadow: 0 0 15px rgba(0,0,0,0.5); }
            50% { border-color: rgba(191, 149, 63, 0.6); box-shadow: 0 0 25px rgba(191, 149, 63, 0.15); }
        }

        /* 按鈕：4秒週期暗金轉亮金 */
        .btn-gold-cycle {
            background: linear-gradient(135deg, #1a1a1a, #0a0a0a);
            color: var(--gold-base);
            border: 1px solid var(--gold-base);
            position: relative;
            z-index: 1;
            overflow: hidden;
            animation: gold-glow 4s linear infinite;
        }

        @keyframes gold-glow {
            0% { border-color: var(--gold-dark); color: var(--gold-dark); box-shadow: none; }
            50% { border-color: var(--gold-bright); color: var(--gold-bright); box-shadow: 0 0 15px rgba(252, 246, 186, 0.3); }
            100% { border-color: var(--gold-dark); color: var(--gold-dark); box-shadow: none; }
        }

        /* 滑鼠點過/觸碰反光 */
        .luxury-card::after {
            content: "";
            position: absolute;
            top: -150%; left: -150%;
            width: 300%; height: 300%;
            background: linear-gradient(135deg, transparent 45%, rgba(252, 246, 186, 0.1) 50%, transparent 55%);
            pointer-events: none;
        }
        .luxury-card:active::after {
            transition: all 0.6s ease;
            top: 100%; left: 100%;
        }

        .inventory-badge {
            background: rgba(191, 149, 63, 0.1);
            border: 0.5px solid rgba(191, 149, 63, 0.5);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="p-6 text-center border-b border-white/5">
        <h1 class="text-2xl gold-text font-bold uppercase tracking-widest">美業庫存管理</h1>
        <p class="text-[9px] text-gray-600 tracking-[0.3em] mt-1">INVENTORY SYSTEM PRO</p>
    </header>

    <main class="flex-1 p-5 space-y-6">
        
        <div class="grid grid-cols-2 gap-4">
            <div class="luxury-card p-4">
                <p class="text-[10px] text-gray-500 uppercase mb-1">今日消耗點數</p>
                <h3 id="daily-points" class="text-xl font-light text-white">0 P</h3>
            </div>
            <div class="luxury-card p-4">
                <p class="text-[10px] text-gray-500 uppercase mb-1">預警庫存數</p>
                <h3 id="alert-count" class="text-xl font-light text-red-400">0</h3>
            </div>
        </div>

        <section class="luxury-card p-6">
            <h2 class="gold-text text-sm mb-5 font-bold tracking-widest">快速服務核銷</h2>
            <div class="space-y-4">
                <div class="flex items-center justify-between p-3 bg-white/5 rounded-xl">
                    <div>
                        <p class="text-sm font-medium">洗頭服務 (一般)</p>
                        <span class="inventory-badge">庫存充足</span>
                    </div>
                    <button onclick="recordService('wash', 1)" class="btn-gold-cycle px-6 py-2 rounded-lg text-xs">核銷 1 次</button>
                </div>
                <div class="flex items-center justify-between p-3 bg-white/5 rounded-xl">
                    <div>
                        <p class="text-sm font-medium">專業染膏 (一管)</p>
                        <span class="inventory-badge text-yellow-500">剩餘 8 支</span>
                    </div>
                    <button onclick="recordService('color', 1)" class="btn-gold-cycle px-6 py-2 rounded-lg text-xs">核銷 1 支</button>
                </div>
            </div>
        </section>

        <section class="luxury-card p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="gold-text text-sm font-bold tracking-widest">會員動態</h2>
                <span id="member-tier" class="text-[10px] bg-yellow-900/20 text-yellow-500 px-2 py-1 rounded">SILVER</span>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between text-xs">
                    <span class="text-gray-500">當前累積消費</span>
                    <span id="total-spent" class="text-white">$0</span>
                </div>
                <div class="w-full h-[2px] bg-gray-800">
                    <div id="tier-progress" class="h-full bg-gradient-to-r from-yellow-700 to-yellow-200 transition-all duration-1000" style="width: 0%"></div>
                </div>
                <p id="next-tier-msg" class="text-[9px] text-gray-600 text-center italic"></p>
            </div>
        </section>

    </main>

    <footer class="p-5 border-t border-white/5 bg-black/50 backdrop-blur-md">
        <button onclick="syncToFirebase()" class="w-full py-4 rounded-full border border-yellow-700/50 gold-text text-xs tracking-widest hover:bg-yellow-700/10 transition active:scale-95">
            同步數據至雲端
        </button>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyCOhBN9TH3UJSOSx5XVyQ08f_2RUckvXYU",
            authDomain: "holyhairsalon-f73bf.firebaseapp.com",
            databaseURL: "https://holyhairsalon-f73bf-default-rtdb.firebaseio.com",
            projectId: "holyhairsalon-f73bf",
            storageBucket: "holyhairsalon-f73bf.firebasestorage.app",
            messagingSenderId: "960169055224",
            appId: "1:960169055224:web:64c044f4484f267abf3c0d",
            measurementId: "G-TLM1NMF4Y1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const userRef = doc(db, "customers", "VIP_USER_TEST");

        const TIER_RULES = { SILVER: 10000, GOLD: 30000, PLATINUM: 100000 };

        // 監聽數據
        onSnapshot(userRef, (snap) => {
            if (snap.exists()) {
                const data = snap.data();
                document.getElementById('total-spent').innerText = `$${data.total_spent.toLocaleString()}`;
                document.getElementById('daily-points').innerText = `${data.points || 0} P`;
                document.getElementById('member-tier').innerText = data.tier;
                
                // 進度條與自動升等邏輯
                const limit = TIER_RULES[data.tier] || 10000;
                const progress = (data.total_spent / limit) * 100;
                document.getElementById('tier-progress').style.width = `${Math.min(progress, 100)}%`;
                document.getElementById('next-tier-msg').innerText = `距離升等還需 $${Math.max(0, limit - data.total_spent).toLocaleString()}`;
            }
        });

        // 核銷服務函式
        window.recordService = async (service, count) => {
            const snap = await getDoc(userRef);
            if (!snap.exists()) return;

            const data = snap.data();
            const cost = service === 'color' ? 2000 : 500; // 模擬核銷產生的消費額
            
            await updateDoc(userRef, {
                total_spent: data.total_spent + cost,
                points: (data.points || 0) + Math.floor(cost / 10)
            });

            // 觸發簡單的反饋效果
            alert(`核銷成功！已紀錄 ${service} 服務。`);
        };

        window.syncToFirebase = () => {
            alert("數據已即時同步至雲端伺服器。");
        };
    </script>
</body>
</html>
